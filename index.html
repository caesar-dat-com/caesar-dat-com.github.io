<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <title>César Reyes — Perfil</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Exo:wght@200;400;600;800&family=JetBrains+Mono:wght@300;600&display=swap"
    rel="stylesheet">

  <style>
    :root {
      --bg0: #070b12;
      --bg1: #0b1220;
      --card: rgba(255, 255, 255, .06);
      --card2: rgba(255, 255, 255, .04);
      --stroke: rgba(255, 255, 255, .14);
      --stroke2: rgba(255, 255, 255, .08);

      --accent: hsl(175 100% 77%);
      --shadow: hsl(10 100% 60%);
      --text: rgba(255, 255, 255, .92);
      --muted: rgba(255, 255, 255, .65);
      --muted2: rgba(255, 255, 255, .45);

      --r: 18px;
      --r2: 26px;

      --mono: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: "Exo", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

      --glow: 0 0 0.9rem color-mix(in oklab, var(--accent) 30%, transparent);
      --shadowGlow: 0 0 1.2rem color-mix(in oklab, var(--shadow) 35%, transparent);
      --elev: 0 14px 50px rgba(0, 0, 0, .55);

      --sbTrack: color-mix(in oklab, var(--bg1) 70%, black);
      --sbThumb: color-mix(in oklab, var(--accent) 40%, rgba(255, 255, 255, .12));
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg0: #f6f8ff;
        --bg1: #edf1ff;
        --card: rgba(0, 0, 0, .04);
        --card2: rgba(0, 0, 0, .03);
        --stroke: rgba(0, 0, 0, .12);
        --stroke2: rgba(0, 0, 0, .08);

        --text: rgba(0, 0, 0, .86);
        --muted: rgba(0, 0, 0, .6);
        --muted2: rgba(0, 0, 0, .45);

        --elev: 0 18px 50px rgba(0, 0, 0, .15);
        --sbTrack: color-mix(in oklab, var(--bg1) 70%, white);
        --sbThumb: color-mix(in oklab, var(--accent) 35%, rgba(0, 0, 0, .10));
      }
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      font-family: var(--sans);
      color: var(--text);
      background: radial-gradient(1200px 800px at 15% 10%, color-mix(in oklab, var(--accent) 10%, transparent), transparent 60%),
        radial-gradient(900px 600px at 85% 20%, color-mix(in oklab, var(--shadow) 10%, transparent), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow: hidden;
      /* internal scrolling only (prevents background breaking on long content) */
    }

    /* Fixed background layers */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: .55;
      background:
        linear-gradient(transparent 31px, rgba(255, 255, 255, .05) 32px),
        linear-gradient(90deg, transparent 31px, rgba(255, 255, 255, .04) 32px);
      background-size: 32px 32px;
      mix-blend-mode: overlay;
      mask-image: radial-gradient(60% 55% at 50% 35%, black, transparent 72%);
    }

    body::after {
      content: "";
      position: fixed;
      inset: -20%;
      pointer-events: none;
      opacity: .08;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.45'/%3E%3C/svg%3E");
      transform: rotate(-7deg);
    }

    /* Scrollbars (same aesthetic as buttons) */
    :where(.scrollArea, body) {
      scrollbar-width: thin;
      scrollbar-color: var(--sbThumb) var(--sbTrack);
    }

    :where(.scrollArea)::-webkit-scrollbar {
      width: 12px;
      height: 12px;
    }

    :where(.scrollArea)::-webkit-scrollbar-track {
      background: var(--sbTrack);
      border: 1px solid var(--stroke2);
      border-radius: 999px;
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, .12);
      margin: 6px;
    }

    :where(.scrollArea)::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg,
          color-mix(in oklab, var(--accent) 50%, rgba(255, 255, 255, .12)),
          color-mix(in oklab, var(--accent) 22%, rgba(255, 255, 255, .08)));
      border-radius: 999px;
      border: 1px solid color-mix(in oklab, var(--accent) 35%, var(--stroke));
      box-shadow: var(--glow);
    }

    :where(.scrollArea)::-webkit-scrollbar-thumb:hover {
      filter: saturate(1.2) brightness(1.06);
    }

    /* Layout */
    .app {
      height: 100dvh;
      display: grid;
      grid-template-columns: 92px minmax(0, 1fr) 340px;
      gap: 16px;
      padding: 16px;
      max-width: 1400px;
      margin: 0 auto;
    }

    @media (max-width: 1100px) {
      .app {
        grid-template-columns: 92px minmax(0, 1fr);
      }

      .rail--right {
        display: none;
      }
    }

    @media (max-width: 760px) {
      .app {
        grid-template-columns: 1fr;
      }

      .rail--left {
        display: none;
      }

      body {
        overflow: auto;
      }

      .stage {
        height: auto;
        overflow: visible;
      }
    }

    .rail {
      border-radius: var(--r2);
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid var(--stroke2);
      box-shadow: var(--elev);
      backdrop-filter: blur(14px);
      position: relative;
      overflow: hidden;
    }

    .rail::before {
      content: "";
      position: absolute;
      inset: -1px;
      pointer-events: none;
      background:
        radial-gradient(600px 200px at 50% -20%, color-mix(in oklab, var(--accent) 22%, transparent), transparent 60%),
        radial-gradient(500px 200px at 70% 115%, color-mix(in oklab, var(--shadow) 16%, transparent), transparent 55%);
      opacity: .9;
    }

    .rail__inner {
      position: relative;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 14px;
      gap: 12px;
    }

    .brand {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 54px;
      border-radius: 16px;
      border: 1px solid var(--stroke2);
      background: rgba(255, 255, 255, .06);
      box-shadow: var(--glow);
      letter-spacing: .14em;
      font-weight: 800;
    }

    .brand small {
      font-size: 11px;
      opacity: .75;
      letter-spacing: .2em;
      font-family: var(--mono);
    }

    .nav {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .cyber-btn {
      all: unset;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 10px;
      border-radius: 16px;
      border: 1px solid var(--stroke2);
      background: linear-gradient(180deg, rgba(255, 255, 255, .09), rgba(255, 255, 255, .04));
      cursor: pointer;
      transition: transform .12s ease, filter .12s ease, border-color .12s ease;
      box-shadow: 0 0 0 rgba(0, 0, 0, 0);
    }

    .cyber-btn:hover {
      transform: translateY(-1px);
      filter: saturate(1.05);
      border-color: color-mix(in oklab, var(--accent) 18%, var(--stroke2));
    }

    .cyber-btn[aria-current="page"] {
      border-color: color-mix(in oklab, var(--accent) 40%, var(--stroke2));
      box-shadow: var(--glow);
    }

    .cyber-btn__left {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: color-mix(in oklab, var(--accent) 55%, rgba(255, 255, 255, .16));
      box-shadow: 0 0 0.7rem color-mix(in oklab, var(--accent) 35%, transparent);
      flex: 0 0 auto;
    }

    .cyber-btn__label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .14em;
      font-weight: 700;
      opacity: .95;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    kbd {
      font-family: var(--mono);
      font-size: 11px;
      padding: 5px 8px;
      border-radius: 12px;
      border: 1px solid var(--stroke2);
      background: rgba(0, 0, 0, .18);
      opacity: .9;
    }

    @media (prefers-color-scheme: light) {
      kbd {
        background: rgba(255, 255, 255, .55);
      }
    }

    .rail__footer {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .mini {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid var(--stroke2);
      background: rgba(255, 255, 255, .05);
    }

    .mini h4 {
      margin: 0;
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
      opacity: .86;
    }

    .mini p {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.35;
    }

    .mini a {
      color: inherit;
      text-decoration: none;
      border-bottom: 1px dashed color-mix(in oklab, var(--accent) 35%, transparent);
    }

    .stage {
      border-radius: var(--r2);
      border: 1px solid var(--stroke2);
      background: linear-gradient(180deg, rgba(255, 255, 255, .06), rgba(255, 255, 255, .03));
      box-shadow: var(--elev);
      backdrop-filter: blur(16px);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      position: relative;
      min-width: 0;
    }

    .stage::before {
      content: "";
      position: absolute;
      inset: -1px;
      pointer-events: none;
      background: linear-gradient(90deg,
          transparent,
          color-mix(in oklab, var(--accent) 10%, transparent),
          transparent);
      opacity: .65;
      transform: translateX(-35%);
      animation: sweep 8s linear infinite;
    }

    @keyframes sweep {
      0% {
        transform: translateX(-35%);
      }

      100% {
        transform: translateX(35%);
      }
    }

    .stage__top {
      position: relative;
      padding: 18px 18px 14px;
      border-bottom: 1px solid var(--stroke2);
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 16px;
    }

    .title {
      margin: 0;
      font-size: clamp(20px, 2.2vw, 28px);
      letter-spacing: .02em;
      font-weight: 800;
    }

    .subtitle {
      margin: 3px 0 0;
      color: var(--muted);
      font-size: 12px;
      letter-spacing: .08em;
      font-family: var(--mono);
      text-transform: uppercase;
    }

    .stage__meta {
      display: flex;
      gap: 10px;
      align-items: center;
      color: var(--muted);
      font-family: var(--mono);
      font-size: 12px;
      white-space: nowrap;
    }

    .stage__body {
      position: relative;
      padding: 14px 14px 16px;
      min-height: 0;
      overflow: auto;
      scrollbar-gutter: stable both-edges;
    }

    .card {
      border-radius: 20px;
      border: 1px solid var(--stroke2);
      background: rgba(255, 255, 255, .05);
      padding: 14px;
      box-shadow: 0 0 0 rgba(0, 0, 0, 0);
    }

    .card+.card {
      margin-top: 12px;
    }

    .grid2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    @media (max-width: 920px) {
      .grid2 {
        grid-template-columns: 1fr;
      }
    }

    .h {
      margin: 0 0 8px;
      font-size: 13px;
      letter-spacing: .14em;
      text-transform: uppercase;
      font-family: var(--mono);
      color: color-mix(in oklab, var(--text) 92%, var(--muted));
    }

    .p {
      margin: 0;
      color: var(--muted);
      line-height: 1.55;
      font-size: 14px;
    }

    .tagrow {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke2);
      background: rgba(0, 0, 0, .16);
      font-family: var(--mono);
      font-size: 12px;
      color: color-mix(in oklab, var(--text) 86%, var(--muted));
    }

    @media (prefers-color-scheme: light) {
      .tag {
        background: rgba(255, 255, 255, .55);
      }
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .item {
      border-radius: 18px;
      border: 1px solid var(--stroke2);
      background: rgba(255, 255, 255, .04);
      padding: 12px;
    }

    .item__top {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
    }

    .item__t {
      margin: 0;
      font-weight: 800;
      font-size: 14px;
      letter-spacing: .02em;
    }

    .item__m {
      margin: 6px 0 0;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.45;
    }

    .when {
      font-family: var(--mono);
      font-size: 11px;
      color: var(--muted2);
      text-transform: uppercase;
      letter-spacing: .12em;
      white-space: nowrap;
    }

    .btn {
      all: unset;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid var(--stroke2);
      background: linear-gradient(180deg,
          color-mix(in oklab, var(--accent) 12%, rgba(255, 255, 255, .08)),
          rgba(255, 255, 255, .04));
      cursor: pointer;
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing: .12em;
      text-transform: uppercase;
      transition: transform .12s ease, filter .12s ease, border-color .12s ease;
      box-shadow: var(--glow);
    }

    .btn:hover {
      transform: translateY(-1px);
      filter: saturate(1.1);
      border-color: color-mix(in oklab, var(--accent) 40%, var(--stroke2));
    }

    .btn--ghost {
      background: rgba(255, 255, 255, .04);
      box-shadow: none;
    }

    /* Right rail widgets */
    .widget {
      border-radius: 20px;
      border: 1px solid var(--stroke2);
      background: rgba(255, 255, 255, .05);
      padding: 12px;
    }

    .widget__top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 8px;
    }

    .widget__title {
      margin: 0;
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
      font-family: var(--mono);
      color: color-mix(in oklab, var(--text) 92%, var(--muted));
    }

    .metric {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
    }

    .bar {
      height: 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke2);
      background: rgba(0, 0, 0, .18);
      overflow: hidden;
      margin-top: 10px;
    }

    .bar>i {
      display: block;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), color-mix(in oklab, var(--shadow) 45%, var(--accent)));
      box-shadow: var(--glow);
    }

    @media (prefers-color-scheme: light) {
      .bar {
        background: rgba(255, 255, 255, .55);
      }
    }

    .smallprint {
      font-family: var(--mono);
      font-size: 11px;
      color: var(--muted2);
      line-height: 1.45;
    }

    /* Modal / popover (centered) */
    .modal {
      width: min(980px, calc(100vw - 32px));
      border-radius: 26px;
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(0, 0, 0, .35), rgba(0, 0, 0, .18));
      box-shadow: 0 24px 80px rgba(0, 0, 0, .6);
      backdrop-filter: blur(18px);
      padding: 0;
      overflow: hidden;
      color: var(--text);
    }

    @media (prefers-color-scheme: light) {
      .modal {
        background: linear-gradient(180deg, rgba(255, 255, 255, .85), rgba(255, 255, 255, .65));
      }
    }

    .modal::backdrop {
      background: rgba(0, 0, 0, .58);
      backdrop-filter: blur(6px);
    }

    [popover] {
      inset: 50% auto auto 50%;
      transform: translate(-50%, -50%);
    }

    [popover]:popover-open {
      animation: popIn .18s ease-out;
    }

    @keyframes popIn {
      from {
        transform: translate(-50%, -48%) scale(.98);
        opacity: 0;
      }

      to {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }

    .modal__header {
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      border-bottom: 1px solid var(--stroke2);
      position: relative;
      background: rgba(255, 255, 255, .03);
    }

    .modal__header h3 {
      margin: 0;
      font-size: 13px;
      font-family: var(--mono);
      letter-spacing: .16em;
      text-transform: uppercase;
    }

    .modal__content {
      padding: 14px;
      max-height: min(68dvh, 680px);
      overflow: auto;
    }

    /* Glitch layer (subtle) */
    .glitch {
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: .12;
      mix-blend-mode: screen;
      background:
        repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255, 255, 255, .25) 3px),
        radial-gradient(1000px 220px at 50% -10%, color-mix(in oklab, var(--accent) 25%, transparent), transparent 65%),
        radial-gradient(900px 260px at 65% 120%, color-mix(in oklab, var(--shadow) 22%, transparent), transparent 60%);
      animation: glitchDrift 8s linear infinite;
      transform: translateZ(0);
    }

    @keyframes glitchDrift {
      0% {
        transform: translate3d(0, 0, 0);
        filter: hue-rotate(0deg);
      }

      50% {
        transform: translate3d(0, -3px, 0);
        filter: hue-rotate(12deg);
      }

      100% {
        transform: translate3d(0, 0, 0);
        filter: hue-rotate(0deg);
      }
    }

    /* Memento grid */
    .mm-wrap {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .mm-stats {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
    }

    .mm-stat {
      border: 1px solid var(--stroke2);
      background: rgba(255, 255, 255, .04);
      border-radius: 18px;
      padding: 12px;
    }

    .mm-stat b {
      display: block;
      font-family: var(--mono);
      letter-spacing: .12em;
      text-transform: uppercase;
      font-size: 11px;
      color: var(--muted);
    }

    .mm-stat span {
      display: block;
      margin-top: 6px;
      font-size: 20px;
      font-weight: 900;
      letter-spacing: .02em;
    }

    .mm-grid {
      border-radius: 22px;
      border: 1px solid var(--stroke2);
      background: rgba(255, 255, 255, .03);
      padding: 12px;
      overflow: auto;
    }

    .mm-grid__inner {
      display: grid;
      grid-auto-rows: 8px;
      grid-template-columns: repeat(52, 8px);
      gap: 3px;
      width: max-content;
    }

    .mm-cell {
      width: 8px;
      height: 8px;
      border-radius: 3px;
      background: rgba(255, 255, 255, .10);
      border: 1px solid rgba(255, 255, 255, .08);
    }

    .mm-cell.past {
      background: color-mix(in oklab, var(--accent) 40%, rgba(255, 255, 255, .12));
      border-color: color-mix(in oklab, var(--accent) 45%, rgba(255, 255, 255, .10));
      box-shadow: 0 0 .5rem color-mix(in oklab, var(--accent) 22%, transparent);
    }

    .mm-cell.current {
      background: linear-gradient(180deg, var(--accent), color-mix(in oklab, var(--shadow) 45%, var(--accent)));
      border-color: color-mix(in oklab, var(--accent) 55%, rgba(255, 255, 255, .12));
      box-shadow: var(--glow), var(--shadowGlow);
    }

    .mm-cell.future {
      background: rgba(255, 255, 255, .06);
      border-color: rgba(255, 255, 255, .06);
    }

    /* Spotify */
    .spotify-embed {
      width: 100%;
      height: 360px;
      border: 0;
      border-radius: 18px;
      overflow: hidden;
      background: rgba(0, 0, 0, .12);
    }

    .sp-top3 {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .sp-artist {
      display: flex;
      align-items: center;
      gap: 10px;
      border: 1px solid var(--stroke2);
      background: rgba(255, 255, 255, .04);
      border-radius: 18px;
      padding: 10px;
    }

    .sp-artist img {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      object-fit: cover;
      border: 1px solid var(--stroke2);
    }

    .sp-artist b {
      font-size: 13px;
    }

    .sp-artist a {
      color: inherit;
      text-decoration: none;
      border-bottom: 1px dashed color-mix(in oklab, var(--accent) 35%, transparent);
    }

    /* Instagram embed area */
    .ig-shell {
      border-radius: 22px;
      border: 1px solid var(--stroke2);
      background: rgba(255, 255, 255, .03);
      padding: 12px;
      overflow: hidden;
    }

    .ig-shell .ig-fallback {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid var(--stroke2);
      background: rgba(255, 255, 255, .04);
    }

    .ig-shell .ig-fallback b {
      font-family: var(--mono);
      letter-spacing: .12em;
      text-transform: uppercase;
      font-size: 12px;
    }

    .ig-shell .ig-embed {
      margin-top: 12px;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid var(--stroke2);
      background: rgba(0, 0, 0, .12);
      padding: 10px;
    }

    .ig-shell blockquote.instagram-media {
      background: transparent !important;
      border: 0 !important;
      margin: 0 auto !important;
      width: 100% !important;
      max-width: 540px !important;
      min-width: 0 !important;
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .stage::before {
        animation: none;
      }

      .glitch {
        animation: none;
      }

      .cyber-btn,
      .btn {
        transition: none;
      }

      [popover]:popover-open {
        animation: none;
      }
    }
  </style>
</head>

<body>
  <div class="app" id="app">

    <!-- LEFT NAV -->
    <aside class="rail rail--left">
      <div class="rail__inner">
        <div class="brand" title="César Reyes">
          <div>
            <div style="font-size:18px; line-height:1; font-weight:900; letter-spacing:.18em;">CR</div>
            <small>PROFILE</small>
          </div>
        </div>

        <nav class="nav" aria-label="Secciones">
          <button class="cyber-btn" data-panel="overview" aria-current="page">
            <span class="cyber-btn__left"><span class="dot"></span><span class="cyber-btn__label">Overview</span></span>
            <kbd>1</kbd>
          </button>
          <button class="cyber-btn" data-panel="experience">
            <span class="cyber-btn__left"><span class="dot"></span><span class="cyber-btn__label">Trabajo</span></span>
            <kbd>2</kbd>
          </button>
          <button class="cyber-btn" data-panel="projects">
            <span class="cyber-btn__left"><span class="dot"></span><span
                class="cyber-btn__label">Proyectos</span></span>
            <kbd>3</kbd>
          </button>
          <button class="cyber-btn" data-panel="skills">
            <span class="cyber-btn__left"><span class="dot"></span><span class="cyber-btn__label">Skills</span></span>
            <kbd>4</kbd>
          </button>
          <button class="cyber-btn" data-panel="education">
            <span class="cyber-btn__left"><span class="dot"></span><span
                class="cyber-btn__label">Educación</span></span>
            <kbd>5</kbd>
          </button>
          <button class="cyber-btn" data-panel="certs">
            <span class="cyber-btn__left"><span class="dot"></span><span class="cyber-btn__label">Certs</span></span>
            <kbd>6</kbd>
          </button>
          <button class="cyber-btn" data-panel="contact">
            <span class="cyber-btn__left"><span class="dot"></span><span class="cyber-btn__label">Contacto</span></span>
            <kbd>7</kbd>
          </button>
        </nav>

        <div class="rail__footer">
          <div class="mini">
            <h4>Shortcuts</h4>
            <p>1–7 secciones · <b>M</b> Memento Mori · <b>S</b> Spotify · <b>I</b> Instagram · <b>Esc</b> cerrar</p>
          </div>
          <div class="mini">
            <h4>Links</h4>
            <p>
              <a id="lnkLinkedIn" href="#" target="_blank" rel="noreferrer">LinkedIn</a> ·
              <a id="lnkGitHub" href="#" target="_blank" rel="noreferrer">GitHub</a><br>
              <a id="lnkSpotify" href="#" target="_blank" rel="noreferrer">Spotify</a> ·
              <a id="lnkInstagram" href="#" target="_blank" rel="noreferrer">Instagram</a>
            </p>
          </div>
        </div>
      </div>
    </aside>

    <!-- STAGE -->
    <main class="stage">
      <header class="stage__top">
        <div>
          <h1 class="title" id="stageTitle">Overview</h1>
          <p class="subtitle" id="stageSubtitle">César Reyes · Bogotá, Colombia</p>
        </div>
        <div class="stage__meta">
          <span class="when" id="stageHint">Usa 1–7 para navegar</span>
        </div>
      </header>

      <div class="stage__body scrollArea" id="stageBody"></div>
    </main>

    <!-- RIGHT RAIL -->
    <aside class="rail rail--right">
      <div class="rail__inner scrollArea" style="overflow:auto;">
        <div class="widget">
          <div class="widget__top">
            <h3 class="widget__title">Quick Actions</h3>
            <button class="btn btn--ghost" id="btnContact" type="button">Contacto <kbd
                style="margin-left:6px">7</kbd></button>
          </div>
          <p class="smallprint" style="margin:0">
            Acciones únicas aquí (sin repetir lo mismo en la parte superior). Todo el contenido vive en el panel
            central.
          </p>
        </div>

        <div class="widget" id="mmWidget">
          <div class="widget__top">
            <h3 class="widget__title">Memento Mori</h3>
            <button class="btn btn--ghost" id="btnMM" type="button">Abrir <kbd style="margin-left:6px">M</kbd></button>
          </div>

          <div class="metric"><span>Semanas vividas</span><b id="mmWeeksLived">—</b></div>
          <div class="metric"><span>Semanas restantes</span><b id="mmWeeksLeft">—</b></div>
          <div class="bar" aria-hidden="true"><i id="mmBar"></i></div>
        </div>

        <div class="widget" id="spWidget">
          <div class="widget__top">
            <h3 class="widget__title">Spotify</h3>
            <button class="btn btn--ghost" id="btnSP" type="button">Abrir <kbd style="margin-left:6px">S</kbd></button>
          </div>
          <div class="metric"><span>Top artistas</span><b id="spTopLabel">—</b></div>
          <p class="smallprint" style="margin:10px 0 0">
            Para mostrar “likes” y top artistas de forma automática a visitantes, lo recomendado es un proxy (para no
            exponer tokens).
          </p>
        </div>

        <div class="widget" id="igWidget">
          <div class="widget__top">
            <h3 class="widget__title">Instagram</h3>
            <button class="btn btn--ghost" id="btnIG" type="button">Abrir <kbd style="margin-left:6px">I</kbd></button>
          </div>
          <p class="smallprint" style="margin:0">
            Previsualización del perfil (si tu cuenta es pública y tienes activado “Embeds”).
          </p>
        </div>

        <div class="widget">
          <div class="widget__top">
            <h3 class="widget__title">Estado</h3>
          </div>
          <p class="p" id="statusLine" style="margin:0">Listo.</p>
        </div>
      </div>
    </aside>
  </div>

  <!-- POPOVER: MEMENTO MORI -->
  <div class="modal" id="mmModal" popover>
    <div class="modal__header">
      <h3>Memento Mori</h3>
      <div style="display:flex; gap:10px; align-items:center;">
        <button class="btn btn--ghost" type="button" id="mmClose">Cerrar <kbd style="margin-left:6px">Esc</kbd></button>
      </div>
      <div class="glitch" aria-hidden="true"></div>
    </div>
    <div class="modal__content scrollArea">
      <div class="mm-wrap">
        <div class="mm-stats">
          <div class="mm-stat"><b>Fin del día</b><span id="tDay">—</span></div>
          <div class="mm-stat"><b>Fin de la semana</b><span id="tWeek">—</span></div>
          <div class="mm-stat"><b>Vida (estimación)</b><span id="tLife">—</span></div>
        </div>

        <div class="card">
          <p class="p" style="margin:0">
            Semanas vividas: <b id="mmLivedBig">—</b> · Semanas restantes: <b id="mmLeftBig">—</b> · Vida estimada: <b
              id="mmLifeYears">—</b> años
          </p>
        </div>

        <div class="mm-grid">
          <div class="mm-grid__inner" id="mmGrid" aria-label="Calendario de semanas"></div>
        </div>

        <p class="smallprint" style="margin:0">
          Ajuste rápido: edita <code style="font-family:var(--mono)">LIFE_EXPECTANCY_YEARS</code>.
        </p>
      </div>
    </div>
  </div>

  <!-- POPOVER: SPOTIFY -->
  <div class="modal" id="spModal" popover>
    <div class="modal__header">
      <h3>Spotify</h3>
      <div style="display:flex; gap:10px; align-items:center;">
        <button class="btn btn--ghost" type="button" id="spClose">Cerrar <kbd style="margin-left:6px">Esc</kbd></button>
      </div>
      <div class="glitch" aria-hidden="true"></div>
    </div>
    <div class="modal__content scrollArea">
      <div class="grid2">
        <div class="card">
          <h4 class="h">Tu perfil</h4>
          <p class="p" style="margin:0">
            <a id="spProfileLink" href="#" target="_blank" rel="noreferrer"
              style="color:inherit;text-decoration:none;border-bottom:1px dashed color-mix(in oklab, var(--accent) 35%, transparent);">
              Abrir en Spotify
            </a>
          </p>
          <p class="smallprint" style="margin:10px 0 0">
            Spotify no ofrece un “embed oficial” de perfil de usuario como iframe (lo típico es embebible para
            playlists/tracks/albums/artists).
            Por eso aquí abrimos tu perfil y embebemos una playlist pública (o tracks individuales).
          </p>

          <h4 class="h" style="margin-top:12px">Top 3 artistas</h4>
          <div class="sp-top3" id="spTop3"></div>
          <p class="smallprint" style="margin:10px 0 0" id="spUpdated">—</p>
        </div>

        <div class="card">
          <h4 class="h">Escuchar</h4>
          <iframe class="spotify-embed" id="spEmbed"
            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
          <div class="tagrow" style="margin-top:12px">
            <button class="btn btn--ghost" type="button" id="spModeInfo">Config</button>
            <button class="btn" type="button" id="spRefresh">Refrescar</button>
          </div>
          <p class="smallprint" style="margin:10px 0 0" id="spHint"></p>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h4 class="h">Canciones guardadas (muestra)</h4>
        <div class="list" id="spTracks"></div>
      </div>
    </div>
  </div>

  <!-- POPOVER: INSTAGRAM -->
  <div class="modal" id="igModal" popover>
    <div class="modal__header">
      <h3>Instagram</h3>
      <div style="display:flex; gap:10px; align-items:center;">
        <button class="btn btn--ghost" type="button" id="igClose">Cerrar <kbd style="margin-left:6px">Esc</kbd></button>
      </div>
      <div class="glitch" aria-hidden="true"></div>
    </div>

    <div class="modal__content scrollArea">
      <div class="grid2">
        <div class="card">
          <h4 class="h">Previsualización</h4>
          <div class="ig-shell">
            <div class="ig-fallback">
              <div>
                <b>Perfil</b>
                <div class="smallprint" id="igInfo" style="margin-top:6px">—</div>
              </div>
              <a class="btn" id="igOpen" href="#" target="_blank" rel="noreferrer">Abrir</a>
            </div>

            <div class="ig-embed" id="igEmbedWrap">
              <!-- Instagram embed will render inside -->
              <div class="smallprint" id="igLoading">Cargando embed…</div>
              <div id="igEmbed"></div>
            </div>
          </div>

          <p class="smallprint" style="margin:10px 0 0">
            Si el embed no carga: revisa que tu cuenta sea pública y que la opción “Embeds” esté activa.
          </p>
        </div>

        <div class="card">
          <h4 class="h">Enlace rápido</h4>
          <p class="p" style="margin:0">
            <a id="igLink" href="#" target="_blank" rel="noreferrer"
              style="color:inherit;text-decoration:none;border-bottom:1px dashed color-mix(in oklab, var(--accent) 35%, transparent);">
              Abrir @caesar__palace
            </a>
          </p>

          <h4 class="h" style="margin-top:12px">Tip</h4>
          <p class="smallprint" style="margin:0">
            Si quieres algo tipo “grid de posts” embebido, normalmente se hace con una herramienta/servicio (feed
            widget) o con un backend que lea contenido.
            Para “solo preview”, el embed oficial de Instagram es lo más liviano.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Templates for panels -->
  <template id="tpl-overview">
    <div class="card">
      <h4 class="h">Quién soy</h4>
      <p class="p" id="ovBio"></p>
      <div class="tagrow" id="ovTags"></div>
    </div>

    <div class="grid2">
      <div class="card">
        <h4 class="h">Ahora</h4>
        <p class="p" id="ovNow"></p>
      </div>
      <div class="card">
        <h4 class="h">Lo que hago</h4>
        <div class="list" id="ovDo"></div>
      </div>
    </div>
  </template>

  <template id="tpl-experience">
    <div class="card">
      <h4 class="h">Trabajo</h4>
      <p class="p">Experiencia y responsabilidades (una sección visible a la vez).</p>
    </div>
    <div class="list" id="xpList"></div>
  </template>

  <template id="tpl-projects">
    <div class="card">
      <h4 class="h">Proyectos</h4>
      <p class="p">Selección con links para ver código y documentación.</p>
    </div>
    <div class="list" id="pjList"></div>
  </template>

  <template id="tpl-skills">
    <div class="grid2">
      <div class="card">
        <h4 class="h">Skills</h4>
        <div class="tagrow" id="skTech"></div>
      </div>
      <div class="card">
        <h4 class="h">Forma de trabajar</h4>
        <div class="tagrow" id="skSoft"></div>
      </div>
    </div>
  </template>

  <template id="tpl-education">
    <div class="card">
      <h4 class="h">Educación</h4>
      <div class="list" id="edList"></div>
    </div>
  </template>

  <template id="tpl-certs">
    <div class="card">
      <h4 class="h">Certificaciones</h4>
      <div class="list" id="ctList"></div>
    </div>
  </template>

  <template id="tpl-contact">
    <div class="card">
      <h4 class="h">Contacto</h4>
      <p class="p">Links directos y CTA corto.</p>
      <div class="tagrow" style="margin-top:12px">
        <a class="btn" id="contactEmail" href="mailto:tu-correo@ejemplo.com">Email</a>
        <a class="btn btn--ghost" id="contactLinkedIn" href="#" target="_blank" rel="noreferrer">LinkedIn</a>
        <a class="btn btn--ghost" id="contactGitHub" href="#" target="_blank" rel="noreferrer">GitHub</a>
        <a class="btn btn--ghost" id="contactSpotify" href="#" target="_blank" rel="noreferrer">Spotify</a>
        <a class="btn btn--ghost" id="contactInstagram" href="#" target="_blank" rel="noreferrer">Instagram</a>
      </div>
    </div>
  </template>

  <script>
    /***********************
     * CONTENT (EDIT THIS) *
     ***********************/
    const PROFILE = {
      name: "César Reyes",
      location: "Bogotá, Colombia",
      headline: "Data · Automation · Product",
      now: "Actualmente en Postobón · Ingeniería de Datos e Inteligencia Artificial",
      bio: "Me enfoco en construir soluciones de datos y automatización con una capa fuerte de calidad, detalle y diseño. Me muevo cómodo entre ingeniería, análisis y producto.",
      links: {
        linkedin: "https://www.linkedin.com/",
        github: "https://github.com/",
        instagram: "https://www.instagram.com/caesar__palace/?__pwa=1",
        spotifyProfile: "https://open.spotify.com/user/31hu2kdccm2vguqtnndm5ecgc2jy?si=fdb28cbfe7b0495b"
      },
      whatIDo: [
        "Automatización (SAP / Excel / Python) con foco en confiabilidad",
        "Modelado y analítica (métricas, reporting, BI)",
        "Prototipos UI (web / dashboards) con estética cuidada"
      ],
      techTags: ["Python", "SQL", "Power BI", "DAX", "Excel Avanzado", "Tableau", "Looker Studio", "Selenium", "Git", "APIs"],
      softTags: [
        "Trabajo en equipo",
        "Toma de decisiones basada en datos",
        "Adaptabilidad y gestión del cambio",
        "Comunicación clara y asertiva",
        "Proactividad y aprendizaje continuo",
        "Atención al detalle y enfoque en la calidad"
      ],
      experience: [
        {
          role: "Gestión / Operación de datos y mantenimiento",
          company: "Postobón",
          when: "Actual",
          bullets: [
            "Seguimiento y control de órdenes, calidad de datos operativos.",
            "Automatizaciones para reducir reprocesos y mejorar trazabilidad.",
            "Integración de reportes y tableros para operación."
          ]
        }
      ],
      projects: [
        {
          name: "BIBLIOCASTIA",
          when: "Repositorio",
          desc: "Scripts y herramientas para automatización, export/import, y flujos de datos.",
          link: "https://github.com/"
        }
      ],
      education: [
        {
          name: "Ingeniería de Datos e Inteligencia Artificial",
          where: "Universidad Autónoma de Occidente (UAO)",
          when: "En curso",
          desc: "Estadística, forecasting, BI, y fundamentos de ingeniería de datos."
        }
      ],
      certs: [
        {
          name: "Ruta de Análisis de Datos y Business Intelligence (18+ cursos)",
          where: "Platzi",
          when: "Completado",
          desc: "Power BI, DAX, Tableau, Looker Studio, Excel avanzado, forecasting, métricas de negocio, storytelling, estadística aplicada; más fundamentos de Python, circuitos electrónicos, electricidad e inglés técnico."
        }
      ]
    };

    /**********************************
     * SPOTIFY SETTINGS (CHOOSE MODE) *
     **********************************
      - "off": no muestra nada
      - "public": embebe una playlist pública y (opcional) carga /spotify.json con topArtists/tracks
      - "proxy": consume un endpoint propio (serverless) que devuelve topArtists y tracks sin exponer tokens al público

      IMPORTANTE:
      - Spotify NO deja leer tus "Saved Tracks" públicamente desde el front sin autorización del usuario. (requiere user-library-read)  // ver docs
      - Para visitantes, lo correcto es: playlist pública + (opcional) proxy.
    */
    const SPOTIFY = {
      mode: "public",                 // "off" | "public" | "proxy"
      spotifyProfileUrl: PROFILE.links.spotifyProfile,
      publicPlaylistUrl: "",          // ej: "https://open.spotify.com/playlist/XXXXXXXX"
      publicDataUrl: "/spotify.json", // para mode="public" (archivo estático que tú publicas)
      proxyUrl: "/api/spotify"        // para mode="proxy" (tu endpoint serverless)
    };

    /******************************
     * INSTAGRAM SETTINGS         *
     ******************************/
    const INSTAGRAM = {
      profileUrl: PROFILE.links.instagram,
      username: "caesar__palace"
    };

    /******************************
     * MEMENTO MORI CONFIG        *
     ******************************/
    const BIRTHDATE_ISO = "2000-01-25T00:00:00-05:00"; // Bogotá
    // Promedio usado: 75.4 años (ajustable)
    const LIFE_EXPECTANCY_YEARS = 75.4;

    /***********************
     * UTILITIES           *
     ***********************/
    const $ = (sel, root = document) => root.querySelector(sel);
    const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
    const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
    const weeksPerYear = 365.2425 / 7;

    const fmtHMS = (ms) => {
      ms = Math.max(0, ms);
      const s = Math.floor(ms / 1000);
      const hh = Math.floor(s / 3600);
      const mm = Math.floor((s % 3600) / 60);
      const ss = s % 60;
      const pad = (x) => String(x).padStart(2, "0");
      return `${pad(hh)}:${pad(mm)}:${pad(ss)}`;
    };

    const fmtLong = (ms) => {
      ms = Math.max(0, ms);
      const s = Math.floor(ms / 1000);
      const days = Math.floor(s / 86400);
      const hrs = Math.floor((s % 86400) / 3600);
      const mins = Math.floor((s % 3600) / 60);
      return `${days}d ${String(hrs).padStart(2, "0")}h ${String(mins).padStart(2, "0")}m`;
    };

    const safeURL = (u) => {
      try { return new URL(u).toString(); } catch { return "#"; }
    };

    function escapeHtml(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    /***********************
     * PANEL RENDERING     *
     ***********************/
    const stageTitle = $("#stageTitle");
    const stageSubtitle = $("#stageSubtitle");
    const stageBody = $("#stageBody");

    const panels = {
      overview: { title: "Overview", subtitle: () => `${PROFILE.name} · ${PROFILE.location}` },
      experience: { title: "Trabajo", subtitle: () => PROFILE.now },
      projects: { title: "Proyectos", subtitle: () => "Código · demos · docs" },
      skills: { title: "Skills", subtitle: () => "Stack + forma de trabajar" },
      education: { title: "Educación", subtitle: () => "Formación" },
      certs: { title: "Certs", subtitle: () => "Cursos y certificaciones" },
      contact: { title: "Contacto", subtitle: () => "Conecta rápido" }
    };

    function mountTemplate(id) {
      const tpl = document.getElementById("tpl-" + id);
      stageBody.innerHTML = "";
      stageBody.appendChild(tpl.content.cloneNode(true));
      stageBody.scrollTop = 0;
    }

    function renderPanel(id) {
      const meta = panels[id];
      if (!meta) return;

      const doSwap = () => {
        stageTitle.textContent = meta.title;
        stageSubtitle.textContent = meta.subtitle();
        mountTemplate(id);
        hydratePanel(id);
        setActiveNav(id);
      };

      if (document.startViewTransition) {
        document.startViewTransition(doSwap);
      } else {
        doSwap();
      }
    }

    function setActiveNav(id) {
      $$(".nav .cyber-btn").forEach(btn => {
        const active = btn.dataset.panel === id;
        btn.setAttribute("aria-current", active ? "page" : "false");
      });
    }

    function hydratePanel(id) {
      if (id === "overview") {
        $("#ovBio").textContent = PROFILE.bio;
        $("#ovNow").textContent = PROFILE.now;

        const tags = $("#ovTags");
        tags.innerHTML = "";
        PROFILE.techTags.slice(0, 6).forEach(t => tags.appendChild(tagEl(t)));

        const list = $("#ovDo");
        list.innerHTML = "";
        PROFILE.whatIDo.forEach(t => list.appendChild(itemEl(t)));
      }

      if (id === "experience") {
        const list = $("#xpList");
        list.innerHTML = "";
        PROFILE.experience.forEach(x => {
          list.appendChild(richItemEl({
            title: `${x.role} — ${x.company}`,
            when: x.when,
            body: x.bullets.join(" · ")
          }));
        });
      }

      if (id === "projects") {
        const list = $("#pjList");
        list.innerHTML = "";
        PROFILE.projects.forEach(p => {
          list.appendChild(richItemEl({
            title: p.name,
            when: p.when,
            body: p.desc,
            link: p.link
          }));
        });
      }

      if (id === "skills") {
        const tech = $("#skTech");
        tech.innerHTML = "";
        PROFILE.techTags.forEach(t => tech.appendChild(tagEl(t)));

        const soft = $("#skSoft");
        soft.innerHTML = "";
        PROFILE.softTags.forEach(t => soft.appendChild(tagEl(t)));
      }

      if (id === "education") {
        const list = $("#edList");
        list.innerHTML = "";
        PROFILE.education.forEach(e => {
          list.appendChild(richItemEl({
            title: `${e.name} — ${e.where}`,
            when: e.when,
            body: e.desc
          }));
        });
      }

      if (id === "certs") {
        const list = $("#ctList");
        list.innerHTML = "";
        PROFILE.certs.forEach(c => {
          list.appendChild(richItemEl({
            title: `${c.name} — ${c.where}`,
            when: c.when,
            body: c.desc
          }));
        });
      }

      if (id === "contact") {
        $("#contactLinkedIn").href = safeURL(PROFILE.links.linkedin);
        $("#contactGitHub").href = safeURL(PROFILE.links.github);
        $("#contactSpotify").href = safeURL(PROFILE.links.spotifyProfile);
        $("#contactInstagram").href = safeURL(PROFILE.links.instagram);
      }
    }

    function tagEl(txt) {
      const el = document.createElement("span");
      el.className = "tag";
      el.textContent = txt;
      return el;
    }

    function itemEl(txt) {
      const el = document.createElement("div");
      el.className = "item";
      el.innerHTML = `
        <div class="item__top"><p class="item__t">${escapeHtml(txt)}</p><span class="when">—</span></div>
      `;
      return el;
    }

    function richItemEl({ title, when, body, link }) {
      const el = document.createElement("div");
      el.className = "item";
      const t = escapeHtml(title);
      const w = escapeHtml(when || "");
      const b = escapeHtml(body || "");
      el.innerHTML = `
        <div class="item__top">
          <p class="item__t">${link ? `<a href="${safeURL(link)}" target="_blank" rel="noreferrer" style="color:inherit;text-decoration:none;border-bottom:1px dashed color-mix(in oklab, var(--accent) 35%, transparent);">${t}</a>` : t}</p>
          <span class="when">${w}</span>
        </div>
        <p class="item__m">${b}</p>
      `;
      return el;
    }

    /***********************
     * SHORTCUTS + NAV     *
     ***********************/
    const navButtons = $$(".nav .cyber-btn");
    navButtons.forEach(btn => btn.addEventListener("click", () => renderPanel(btn.dataset.panel)));

    window.addEventListener("keydown", (e) => {
      const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : "";
      const typing = tag === "input" || tag === "textarea" || e.target?.isContentEditable;
      if (typing) return;

      const key = e.key.toLowerCase();
      if (key >= "1" && key <= "7") {
        const idx = Number(key) - 1;
        const target = navButtons[idx];
        if (target) renderPanel(target.dataset.panel);
      }
      if (key === "m") openMM();
      if (key === "s") openSP();
      if (key === "i") openIG();
      if (key === "escape") closeAnyPopover();
    });

    /***********************
     * POPOVERS (MM/SP/IG) *
     ***********************/
    const mmModal = $("#mmModal");
    const spModal = $("#spModal");
    const igModal = $("#igModal");

    function openPopover(el) {
      if (!el) return;
      if (el.matches(":popover-open")) return;
      el.showPopover?.();
    }
    function closePopover(el) {
      if (!el) return;
      el.hidePopover?.();
    }
    function closeAnyPopover() {
      closePopover(mmModal);
      closePopover(spModal);
      closePopover(igModal);
    }

    $("#btnMM").addEventListener("click", openMM);
    $("#mmClose").addEventListener("click", () => closePopover(mmModal));

    $("#btnSP").addEventListener("click", openSP);
    $("#spClose").addEventListener("click", () => closePopover(spModal));

    $("#btnIG").addEventListener("click", openIG);
    $("#igClose").addEventListener("click", () => closePopover(igModal));

    $("#btnContact").addEventListener("click", () => renderPanel("contact"));

    function openMM() {
      openPopover(mmModal);
      if (!mmGridBuilt) buildMementoGrid();
    }
    function openSP() {
      openPopover(spModal);
      loadSpotify();
    }
    function openIG() {
      openPopover(igModal);
      loadInstagram();
    }

    /***********************
     * MEMENTO MORI        *
     ***********************/
    const birth = new Date(BIRTHDATE_ISO);
    const lifeMs = LIFE_EXPECTANCY_YEARS * 365.2425 * 24 * 60 * 60 * 1000;
    const deathMs = birth.getTime() + lifeMs;

    function getMemento() {
      const now = new Date();

      const livedWeeks = Math.floor((now - birth) / (7 * 24 * 60 * 60 * 1000));
      const totalWeeks = Math.round(LIFE_EXPECTANCY_YEARS * weeksPerYear);
      const leftWeeks = Math.max(0, totalWeeks - livedWeeks);

      // End of day: next midnight
      const endDay = new Date(now);
      endDay.setHours(24, 0, 0, 0);

      // End of week: Sunday 23:59:59.999 (local)
      const endWeek = new Date(now);
      const dow = endWeek.getDay(); // 0 Sunday
      const daysToSun = (7 - dow) % 7;
      endWeek.setDate(endWeek.getDate() + daysToSun);
      endWeek.setHours(23, 59, 59, 999);

      return {
        now,
        livedWeeks,
        totalWeeks,
        leftWeeks,
        endDay,
        endWeek,
        death: new Date(deathMs)
      };
    }

    function tickMemento() {
      const m = getMemento();
      $("#mmWeeksLived").textContent = String(m.livedWeeks);
      $("#mmWeeksLeft").textContent = String(m.leftWeeks);

      $("#mmLivedBig").textContent = String(m.livedWeeks);
      $("#mmLeftBig").textContent = String(m.leftWeeks);
      $("#mmLifeYears").textContent = String(LIFE_EXPECTANCY_YEARS);

      const pct = clamp((m.livedWeeks / m.totalWeeks) * 100, 0, 100);
      $("#mmBar").style.width = pct.toFixed(1) + "%";

      $("#tDay").textContent = fmtHMS(m.endDay - m.now) + " (" + fmtLong(m.endDay - m.now) + ")";
      $("#tWeek").textContent = fmtHMS(m.endWeek - m.now) + " (" + fmtLong(m.endWeek - m.now) + ")";
      $("#tLife").textContent = fmtLong(m.death - m.now);

      if (mmGridBuilt) paintMementoGrid(m.livedWeeks);
    }

    let mmGridBuilt = false;
    let mmTotalWeeks = 0;

    function buildMementoGrid() {
      const m = getMemento();
      mmTotalWeeks = m.totalWeeks;

      const rows = Math.ceil(mmTotalWeeks / 52);
      const grid = $("#mmGrid");
      grid.innerHTML = "";
      grid.style.gridTemplateRows = `repeat(${rows}, 8px)`;

      for (let i = 0; i < mmTotalWeeks; i++) {
        const cell = document.createElement("div");
        cell.className = "mm-cell future";
        cell.title = `Semana ${i + 1}`;
        cell.dataset.i = String(i);
        grid.appendChild(cell);
      }

      mmGridBuilt = true;
      paintMementoGrid(m.livedWeeks);
    }

    function paintMementoGrid(livedWeeks) {
      const grid = $("#mmGrid");
      const cells = grid.children;
      for (let i = 0; i < cells.length; i++) {
        const c = cells[i];
        if (i < livedWeeks) c.className = "mm-cell past";
        else if (i === livedWeeks) c.className = "mm-cell current";
        else c.className = "mm-cell future";
      }
    }

    /***********************
     * SPOTIFY (PUBLIC/PROXY) *
     ***********************/
    const spTop3 = $("#spTop3");
    const spTracks = $("#spTracks");
    const spEmbed = $("#spEmbed");
    const spHint = $("#spHint");
    const spUpdated = $("#spUpdated");
    const spTopLabel = $("#spTopLabel");

    $("#spRefresh").addEventListener("click", loadSpotify);
    $("#spModeInfo").addEventListener("click", () => {
      alert(
        `Modo actual: ${SPOTIFY.mode}\n\n` +
        `public: embebe una playlist pública (SPOTIFY.publicPlaylistUrl) y opcionalmente lee ${SPOTIFY.publicDataUrl}\n` +
        `proxy: consume ${SPOTIFY.proxyUrl} (recomendado para mostrar a visitantes sin exponer tokens)\n\n` +
        `Estructura esperada (JSON):\n` +
        `{\n  "updatedAt": "2026-01-03T00:00:00-05:00",\n  "topArtists":[{"name":"...","url":"...","image":"..."}],\n  "tracks":[{"name":"...","artists":"...","url":"...","id":"spotifyTrackId"}]\n}`
      );
    });

    function toEmbedUrl(openUrl) {
      const u = String(openUrl || "");
      if (!u) return "";
      return u.replace("open.spotify.com/", "open.spotify.com/embed/");
    }

    async function loadSpotify() {
      spTop3.innerHTML = "";
      spTracks.innerHTML = "";
      spUpdated.textContent = "—";
      spTopLabel.textContent = "—";

      $("#spProfileLink").href = safeURL(SPOTIFY.spotifyProfileUrl);

      if (SPOTIFY.mode === "off") {
        spHint.textContent = "Spotify está desactivado en config.";
        return;
      }

      if (SPOTIFY.mode === "public") {
        if (SPOTIFY.publicPlaylistUrl) {
          spEmbed.src = toEmbedUrl(SPOTIFY.publicPlaylistUrl);
          spHint.textContent = "Playlist pública embebida.";
        } else {
          spEmbed.src = "";
          spHint.textContent = "Pon una playlist pública en SPOTIFY.publicPlaylistUrl. Ej: playlist con tus ‘likes’ curados.";
        }

        try {
          const res = await fetch(SPOTIFY.publicDataUrl, { cache: "no-store" });
          if (!res.ok) throw new Error("No public data");
          const data = await res.json();
          hydrateSpotifyData(data);
        } catch {
          hydrateSpotifyData({ updatedAt: null, topArtists: [], tracks: [] });
        }
        return;
      }

      if (SPOTIFY.mode === "proxy") {
        spHint.textContent = "Cargando desde proxy…";
        try {
          const res = await fetch(SPOTIFY.proxyUrl, { cache: "no-store" });
          if (!res.ok) throw new Error("Proxy error");
          const data = await res.json();
          hydrateSpotifyData(data);
          spHint.textContent = "Datos cargados desde proxy.";
        } catch (err) {
          spHint.textContent = "No se pudo cargar Spotify. Revisa SPOTIFY.proxyUrl y tu endpoint.";
        }
      }
    }

    function hydrateSpotifyData(data) {
      const top = (data.topArtists || []).slice(0, 3);
      const tracks = (data.tracks || []).slice(0, 10);

      spTopLabel.textContent = top.length ? `${top.length}/3` : "—";

      spTop3.innerHTML = top.length ? "" : `<p class="smallprint" style="margin:0">Aún no hay datos. Usa modo public (playlist) o proxy.</p>`;
      top.forEach((a, idx) => {
        const el = document.createElement("div");
        el.className = "sp-artist";
        el.innerHTML = `
          <img alt="" src="${escapeHtml(a.image || "")}" />
          <div style="min-width:0">
            <b>#${idx + 1}</b>
            <div style="font-size:13px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
              <a href="${safeURL(a.url || "#")}" target="_blank" rel="noreferrer">${escapeHtml(a.name || "—")}</a>
            </div>
          </div>
        `;
        spTop3.appendChild(el);
      });

      spTracks.innerHTML = tracks.length ? "" : `<p class="smallprint" style="margin:0">Sin tracks para mostrar.</p>`;
      tracks.forEach((t) => {
        const el = document.createElement("div");
        el.className = "item";
        const title = `${t.name || "—"} — ${t.artists || ""}`;
        el.innerHTML = `
          <div class="item__top">
            <p class="item__t" style="margin:0">${escapeHtml(title)}</p>
            <span class="when">PLAY</span>
          </div>
          <p class="item__m" style="margin:6px 0 0">
            <a href="${safeURL(t.url || "#")}" target="_blank" rel="noreferrer" style="color:inherit;text-decoration:none;border-bottom:1px dashed color-mix(in oklab, var(--accent) 35%, transparent);">
              Abrir en Spotify
            </a>
            · <button class="btn btn--ghost" type="button" style="margin-left:8px; padding:8px 10px; border-radius:14px" data-track="${escapeHtml(t.id || "")}">Embeder</button>
          </p>
        `;
        spTracks.appendChild(el);
      });

      $$("#spTracks [data-track]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.dataset.track;
          if (!id) return;
          spEmbed.src = `https://open.spotify.com/embed/track/${id}`;
        });
      });

      if (data.updatedAt) {
        spUpdated.textContent = "Actualizado: " + data.updatedAt;
        $("#statusLine").textContent = "Spotify listo · " + data.updatedAt;
      } else {
        spUpdated.textContent = "Actualizado: —";
      }
    }

    /***********************
     * INSTAGRAM EMBED     *
     ***********************/
    let igScriptPromise = null;

    function loadInstagramScript() {
      if (igScriptPromise) return igScriptPromise;
      igScriptPromise = new Promise((resolve, reject) => {
        const existing = document.querySelector('script[data-ig-embed="1"]');
        if (existing) {
          resolve(true);
          return;
        }
        const s = document.createElement("script");
        s.async = true;
        s.defer = true;
        s.dataset.igEmbed = "1";
        s.src = "https://www.instagram.com/embed.js";
        s.onload = () => resolve(true);
        s.onerror = () => reject(new Error("Failed to load Instagram embed.js"));
        document.body.appendChild(s);
      });
      return igScriptPromise;
    }

    async function loadInstagram() {
      $("#igOpen").href = safeURL(INSTAGRAM.profileUrl);
      $("#igLink").href = safeURL(INSTAGRAM.profileUrl);
      $("#igInfo").textContent = `@${INSTAGRAM.username}`;
      $("#igLoading").textContent = "Cargando embed…";

      const embedHost = $("#igEmbed");
      embedHost.innerHTML = "";

      // Instagram embed expects a blockquote with data-instgrm-permalink
      // Profile embed works only if account is public and "Embeds" setting enabled.
      const permalink = INSTAGRAM.profileUrl.replace(/\?.*$/, "") + "?utm_source=ig_embed&utm_campaign=loading";

      const block = document.createElement("blockquote");
      block.className = "instagram-media";
      block.setAttribute("data-instgrm-permalink", permalink);
      block.setAttribute("data-instgrm-version", "14");
      block.innerHTML = `
        <div style="padding:12px">
          <a href="${safeURL(INSTAGRAM.profileUrl)}" target="_blank" rel="noreferrer" style="color:inherit;text-decoration:none;border-bottom:1px dashed color-mix(in oklab, var(--accent) 35%, transparent);">
            Ver en Instagram
          </a>
        </div>
      `;
      embedHost.appendChild(block);

      try {
        await loadInstagramScript();
        // Process embed
        if (window.instgrm && window.instgrm.Embeds && typeof window.instgrm.Embeds.process === "function") {
          window.instgrm.Embeds.process();
          $("#igLoading").textContent = "";
          $("#statusLine").textContent = "Instagram listo.";
        } else {
          $("#igLoading").textContent = "Embed no disponible (script cargó, pero no expuso instgrm).";
        }
      } catch {
        $("#igLoading").textContent = "No se pudo cargar el embed. Se mostrará el enlace.";
      }
    }

    /***********************
     * INIT                *
     ***********************/
    function initLinks() {
      $("#lnkLinkedIn").href = safeURL(PROFILE.links.linkedin);
      $("#lnkGitHub").href = safeURL(PROFILE.links.github);
      $("#lnkSpotify").href = safeURL(PROFILE.links.spotifyProfile);
      $("#lnkInstagram").href = safeURL(PROFILE.links.instagram);

      $("#contactLinkedIn").href = safeURL(PROFILE.links.linkedin);
      $("#contactGitHub").href = safeURL(PROFILE.links.github);
      $("#contactSpotify").href = safeURL(PROFILE.links.spotifyProfile);
      $("#contactInstagram").href = safeURL(PROFILE.links.instagram);
    }

    // Make widgets clickable
    $("#mmWidget").addEventListener("click", (e) => {
      const tag = e.target?.tagName?.toLowerCase();
      if (tag === "button" || tag === "a") return;
      openMM();
    });
    $("#spWidget").addEventListener("click", (e) => {
      const tag = e.target?.tagName?.toLowerCase();
      if (tag === "button" || tag === "a") return;
      openSP();
    });
    $("#igWidget").addEventListener("click", (e) => {
      const tag = e.target?.tagName?.toLowerCase();
      if (tag === "button" || tag === "a") return;
      openIG();
    });

    // Tick clocks
    setInterval(tickMemento, 1000);

    initLinks();
    renderPanel("overview");
    tickMemento();

    // Preload Spotify UI hint
    if (SPOTIFY.mode === "off") $("#spHint").textContent = "Spotify desactivado.";
    else $("#spHint").textContent = "Pulsa “Refrescar” para cargar datos.";
  </script>
</body>

</html>